{
    "variables": {
      "packer_profile": "packer",
      "branch_name": "{{env `BRANCH_NAME`}}",
      "admin_pass": "{{env `WIN_ADMIN_PASS`}}",
      "zaizi_bucket": "{{env `ZAIZI_BUCKET`}}"
    },
    "builders": [
      {
        "type": "amazon-ebs",
        "communicator": "winrm",
        "winrm_username": "Administrator",
        "winrm_password": "{{user `admin_pass`}}",
        "winrm_use_ssl": false,
        "winrm_insecure": true,
        "region": "eu-west-2",
        "vpc_id": "vpc-02321f288159e5d0e",
        "subnet_id": "subnet-00982fba28419ac5f",
        "temporary_security_group_source_cidr": "10.0.0.0/8",
        "source_ami_filter": {
          "filters": {
            "virtualization-type": "hvm",
            "architecture": "x86_64",
            "name": "HMPPS Windows Server Base master *",
            "root-device-type": "ebs"
          },
          "owners": ["895523100917"],
          "most_recent": true
        },
        "instance_type": "t2.micro",
        "ami_regions": ["eu-west-2"],
        "ami_users": [
            "895523100917",
            "723123699647",
            "728765553488",
            "130975965028",
            "205048117103",
            "563502482979",
            "010587221707",
            "050243167760",
            "716683748953",
            "645753425509",
            "330914586320",
            "130847504577",
            "077643444046",
            "479759138745",
            "349354156492",
            "431912413968"
        ],
        "ami_name": "HMPPS IAPS Windows Server {{user `branch_name`}} {{timestamp}}",
        "tags": {
          "OS_Version": "Windows Server 2012 R2 RTM",
          "Base_AMI_Name": "{{ .SourceAMIName }}",
          "Base_AMI_ID": "{{ .SourceAMI }}",
          "Name": "HMPPS IAPS Windows Server {{user `branch_name`}} {{timestamp}}"
        }
      }
    ],
    "provisioners": [
        {
            "type": "windows-shell",
            "script": "scripts/windows/iaps/InstallPackages.bat"
        },
        {
            "type": "powershell",
            "script": "scripts/windows/iaps/GetS3SetupArtefacts.ps1",
            "environment_vars": ["ZAIZI_BUCKET={{user `zaizi_bucket`}}"]   
        }
    ]
  }
  